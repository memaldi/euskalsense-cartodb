<html>
    <head>
        <style>
          html, body, #map {
            height: 100%;
            padding: 0;
            margin: 0;
          }
          #date_selector {
            position: absolute;
            top: 120px;
            right: 20px;
            padding: 0;
            width: 305px;
            }
          body {
            padding-top: 50px;
          }
          .starter-template {
            padding: 40px 15px;
            text-align: center;
          }

        </style>
        <link href="static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <!--<link href="starter-template.css" rel="stylesheet">-->
        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.11/themes/css/cartodb.css" />
        <title>EuskalSense</title>
    </head>
    </body>
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#">EuskalSense</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </nav>

        <div id="map"></div>

        <div id="date_selector" class="cartodb-infobox">
          <div class="form-inline">
            <div class="form-group">
              <div class="input-group">
                <input type="datetime-local" class="form-control" id="datetime-picker" style="width: 233px;">
              </div>
            </div>
            <button type="submit" class="btn btn-default" onclick="updateDate()">Check</button>
          </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="http://libs.cartocdn.com/cartodb.js/v3/3.11/cartodb.js"></script>
        <script src="static/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript">

        var cartoDBLayer;
        var cartoDBLegends;

        cartodb.createVis('map', 'http://memaldi.cartodb.com/api/v2/viz/95288572-73f0-11e4-bcc3-0e018d66dc29/viz.json')
        .done(function(vis, layers) {
          cartoDBLayer = layers[1];
          cartoDBLegends = vis.legends;
        });

        function updateDate() {
          var fecha = $("#datetime-picker")[0].value;


          var temperaturaSubLayerOptions = {
            sql: "SELECT * FROM t_c2_ba WHERE (fecha >= ('" + fecha +  "') AND fecha <= ('" + fecha + "') AND valor IS NOT NULL)"
          }

          var sql = new cartodb.SQL({ user: 'memaldi' });

          //Viento
          sql.execute("SELECT MAX(valor), MIN(valor) FROM v_vien WHERE (fecha >= ('" + fecha +  "') AND fecha <= ('" + fecha + "') AND valor IS NOT NULL)")
            .done(function(data) {
              var min;
              var max;
              $.each(data['rows'], function(key, value) {
                max = value['max'];
                min = value['min'];
              });

              $("#legend-v_vien .min")[0].innerText = min;
              $("#legend-v_vien .max")[0].innerText = max;

              var vientoSubLayerOptions = {
                sql: "SELECT * FROM v_vien WHERE (fecha >= ('" + fecha +  "') AND fecha <= ('" + fecha + "') AND valor IS NOT NULL)"
              }
              cartoDBLayer.getSubLayer(0).set(vientoSubLayerOptions);
            })
            .error(function(errors) {
              // errors contains a list of errors
              console.log("errors:" + errors);
          });


          cartoDBLayer.getSubLayer(1).set(temperaturaSubLayerOptions);

        }

        </script>

    </body>
</html>